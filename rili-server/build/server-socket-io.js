!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var o=t();for(var s in o)("object"==typeof exports?exports:e)[s]=o[s]}}(global,function(){return function(e){var t={};function o(s){if(t[s])return t[s].exports;var r=t[s]={i:s,l:!1,exports:{}};return e[s].call(r.exports,r,r.exports,o),r.l=!0,r.exports}return o.m=e,o.c=t,o.d=function(e,t,s){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(o.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(s,r,function(t){return e[t]}.bind(null,r));return s},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/",o(o.s="RRgj")}({"1hBF":function(e,t,o){global,e.exports=function(e){var t={};function o(s){if(t[s])return t[s].exports;var r=t[s]={i:s,l:!1,exports:{}};return e[s].call(r.exports,r,r.exports,o),r.l=!0,r.exports}return o.m=e,o.c=t,o.d=function(e,t,s){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(o.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(s,r,function(t){return e[t]}.bind(null,r));return s},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/",o(o.s="Sxyf")}({Sxyf:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=(e=>{if(e.shouldPrintLogs){const t=0!==e.time?`<at:${e.time||new Date}>`:"",o=Array.isArray(e.messages)?e.messages:[e.messages];for(let s=0;s<o.length;s+=1)e.messageOrigin?console.info(`${e.messageOrigin}${t}:`,o[s]):console.info(`LOG${t}:`,o[s])}})}})},"2apR":function(e,t,o){global,e.exports=function(e){var t={};function o(s){if(t[s])return t[s].exports;var r=t[s]={i:s,l:!1,exports:{}};return e[s].call(r.exports,r,r.exports,o),r.l=!0,r.exports}return o.m=e,o.c=t,o.d=function(e,t,s){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(o.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(s,r,function(t){return e[t]}.bind(null,r));return s},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/",o(o.s="XDo8")}({XDo8:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=((e,t)=>(o,s)=>{o&&t(o),e(s)})}})},"2lJc":function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=(e=>{const t=[];return Object.keys(e).filter(t=>1!==e[t].length||t!==Object.keys(e[t].sockets)[0]).forEach(o=>t.push({roomKey:o,length:e[o].length,sockets:Object.keys(e[o].sockets).map(t=>({socketId:t,active:e[o].sockets[t]}))})),t})},"40N5":function(e,t,o){global,e.exports=function(e){var t={};function o(s){if(t[s])return t[s].exports;var r=t[s]={i:s,l:!1,exports:{}};return e[s].call(r.exports,r,r.exports,o),r.l=!0,r.exports}return o.m=e,o.c=t,o.d=function(e,t,s){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(o.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(s,r,function(t){return e[t]}.bind(null,r));return s},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/",o(o.s="jxKE")}({"2onj":function(e,t,o){"use strict";var s;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.JOIN_ROOM="CLIENT:JOIN_ROOM",e.LOGIN="CLIENT:LOGIN",e.LOGOUT="CLIENT:LOGOUT",e.REGISTER="CLIENT:REGISTER",e.SEND_MESSAGE="CLIENT:SEND_MESSAGE"}(s||(s={})),t.default=s},"8chb":function(e,t,o){"use strict";var s;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.DISCONNECT="SERVER:DISCONNECT",e.JOINED_ROOM="SERVER:JOINED_ROOM",e.LEFT_ROOM="SERVER:LEFT_ROOM",e.OTHER_JOINED_ROOM="SERVER:OTHER_JOINED_ROOM",e.SEND_ROOMS_LIST="SERVER:SEND_ROOMS_LIST",e.SEND_MESSAGE="SERVER:SEND_MESSAGE",e.SESSION_CREATED_MESSAGE="SERVER:SESSION_CREATED_MESSAGE",e.SESSION_CLOSED_MESSAGE="SERVER:SESSION_CLOSED_MESSAGE",e.USER_LOGIN_SUCCESS="SERVER:USER_LOGIN_SUCCESS",e.USER_LOGOUT_SUCCESS="SERVER:USER_LOGOUT_SUCCESS"}(s||(s={})),t.default=s},jxKE:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=o("2onj");t.SocketClientActionTypes=s.default;const r=o("8chb");t.SocketServerActionTypes=r.default,t.SERVER_PREFIX="SERVER",t.WEB_CLIENT_PREFIX="CLIENT"}})},"5GEx":function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=o("AtKU"),r=o("WNab");t.default=class{constructor(e){this.client=e.client,this.redisHelper=new r.default(this.client)}create(e){const t=Object.assign({},{app:e.app,socketId:e.socketId,ip:e.ip.toString(),ttl:e.ttl||s.production.socket.userSocketSessionExpire,data:JSON.stringify(e.data)});return this.redisHelper.storeUser(t).then(()=>t)}remove(e){return this.redisHelper.removeUser(e)}get(e){return this.redisHelper.getUser(e)}}},"7Hn7":function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=o("wy2R"),r=o("1hBF"),n=o("40N5"),i=o("jxKE"),u=o("RRgj");t.default=((e,t,o)=>{const a=s(Date.now()).format("MMMM D/YY, h:mma");e.handshake&&e.handshake.headers&&e.handshake.headers.host&&t.create({app:u.rsAppName,socketId:e.id,ip:e.handshake.headers.host.split(":")[0],ttl:18e5,data:{idToken:o.idToken,userName:o.userName}}).then(t=>{e.emit(i.ACTION,{type:n.SocketServerActionTypes.SESSION_CREATED_MESSAGE,data:t})}).catch(e=>{r.default({shouldPrintLogs:u.shouldPrintRedisLogs,messageOrigin:"REDIS_SESSION_ERROR",messages:e.toString()})}),r.default({shouldPrintLogs:u.shouldPrintSocketLogs,messageOrigin:"SOCKET_IO_LOGS",messages:`User, ${o.userName} with socketId ${e.id}, has logged in.`}),e.emit(i.ACTION,{type:n.SocketServerActionTypes.USER_LOGIN_SUCCESS,data:{message:{key:Date.now().toString(),time:a,text:"You have been logged in successfully."},userName:o.userName}})})},"7WL4":function(e,t){e.exports=require("https")},AtKU:function(e,t){e.exports={development:{apiPort:7770,baseApiRoute:"http://localhost:7770/api/v1",baseSocketUrl:"http://localhost:7743",googleAnalyticsKey:"",host:"localhost",redisPubHost:"rili-redis-pub",redisSubHost:"rili-redis-sub",redisPubPort:6379,redisSubPort:6379,socketPort:7743,socket:{pingInterval:1e4,pingTimeout:5e3,userSocketSessionExpire:36e5}},stage:{apiPort:7770,baseApiRoute:"http://stage.rili.live:7770/api/v1",baseSocketUrl:"http://stage.rili.live:7743",googleAnalyticsKey:"",host:"stage.rili.live",redisPubHost:"rili-redis-pub",redisSubHost:"rili-redis-sub",redisPubPort:6379,redisSubPort:6379,socketPort:7743,socket:{pingInterval:1e4,pingTimeout:5e3,userSocketSessionExpire:36e5}},production:{apiPort:7770,baseApiRoute:"https://rili.live:7770/api/v1",baseSocketUrl:"https://rili.live:7743",googleAnalyticsKey:"",host:"rili.live",redisPubHost:"rili-redis-pub",redisSubHost:"rili-redis-sub",redisPubPort:17771,redisSubPort:17772,socketPort:7743,socket:{pingInterval:1e4,pingTimeout:5e3,userSocketSessionExpire:36e5}}}},"F+p8":function(e,t){e.exports=require("socket.io")},KEll:function(e,t){e.exports=require("http")},MEnT:function(e,t,o){"use strict";var s;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.USER_EXISTS="userExists"}(s||(s={})),t.default=s},RRgj:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=o("ZEFf"),r=o("mw/K"),n=(o("KEll"),o("7WL4")),i=o("wy2R"),u=o("TM0L"),a=o("F+p8"),c=o("xpYa"),l=o("h5LZ"),d=o("mCUW"),S=o("40N5"),f=o("jxKE"),p=o("1hBF"),g=o("AtKU"),O=o("5GEx"),m=o("2lJc");t.rsAppName="riliChat",t.shouldPrintAllLogs=l.argv.withAllLogs,t.shouldPrintRedisLogs=l.argv.withRedisLogs||t.shouldPrintAllLogs,t.shouldPrintSocketLogs=l.argv.withSocketLogs||t.shouldPrintAllLogs||t.shouldPrintRedisLogs;const E=[{host:g.production.redisPubHost,port:g.production.redisPubPort},{host:g.production.redisSubHost,port:g.production.redisSubPort}],_=new u(E[0].port,E[0].host,{connectionName:"redisSocketPub",lazyConnect:!0}),h=new O.default({client:_}),b=new u(E[0].port,E[0].host,{connectionName:"redisSocketSub",lazyConnect:!0}),y=[_.connect(),b.connect()];Promise.all(y).then(e=>{t.shouldPrintRedisLogs&&_.monitor().then(e=>{e.on("monitor",(e,t,o,s)=>{p.default({time:e,shouldPrintLogs:!0,messageOrigin:"REDIS_PUB_LOG",messages:[`Source: ${o}, Database: ${s}`,...t]})})}),R()});const R=()=>{const e=s();let o;{const t={key:r.readFileSync(process.env.DOMAIN_KEY_LOCATION),cert:r.readFileSync(process.env.DOMAIN_CERT_LOCATION)};o=n.createServer(t,e)}const i=o.listen(g.production.socketPort,"localhost",e=>{const t=g.production.socketPort;p.default({shouldPrintLogs:!0,messageOrigin:"SOCKET_IO_LOGS",messages:`Server running on port, ${t}, with process id ${process.pid}`})}),u=a(i,{pingInterval:g.production.socket.pingInterval,pingTimeout:g.production.socket.pingTimeout}),l=c({pubClient:_,subClient:b});u.adapter(l),l.pubClient.on("error",e=>{p.default({shouldPrintLogs:t.shouldPrintRedisLogs,messageOrigin:"REDIS_PUB_CLIENT_ERROR",messages:e.toString()})}),l.subClient.on("error",e=>{p.default({shouldPrintLogs:t.shouldPrintRedisLogs,messageOrigin:"REDIS_SUB_CLIENT_ERROR",messages:e.toString()})}),l.subClient.on("subscribe",(e,o)=>{p.default({shouldPrintLogs:t.shouldPrintRedisLogs,messageOrigin:"REDIS_SUB_CLIENT",messages:`Subscribed to ${e}. Now subscribed to ${o} channel(s).`})}),l.subClient.on("message",(e,o)=>{p.default({shouldPrintLogs:t.shouldPrintRedisLogs,messageOrigin:"REDIS_SUB_CLIENT",messages:`Message from channel ${e}: ${o}`})}),u.on("connection",e=>{p.default({shouldPrintLogs:t.shouldPrintSocketLogs,messageOrigin:"SOCKET_IO_LOGS",messages:"NEW CONNECTION..."}),p.default({shouldPrintLogs:t.shouldPrintSocketLogs,messageOrigin:"SOCKET_IO_LOGS",messages:`All Rooms: ${JSON.stringify(m.default(u.sockets.adapter.rooms))}`}),e.emit(f.ACTION,{type:S.SocketServerActionTypes.SEND_ROOMS_LIST,data:m.default(u.sockets.adapter.rooms)}),e.on(f.ACTION,t=>{switch(t.type){case S.SocketClientActionTypes.JOIN_ROOM:d.joinRoom(e,h,t.data);break;case S.SocketClientActionTypes.LOGIN:d.login(e,h,t.data);break;case S.SocketClientActionTypes.LOGOUT:d.logout(e,h,t.data);break;case S.SocketClientActionTypes.SEND_MESSAGE:d.sendMessage(e,t.data)}}),e.on("disconnecting",o=>{p.default({shouldPrintLogs:t.shouldPrintSocketLogs,messageOrigin:"SOCKET_IO_LOGS",messages:`DISCONNECTING... ${o}`}),P(e)})})},P=e=>{const o=Object.keys(e.rooms).filter(t=>t!==e.id);o.length&&h.get(e.id).then(t=>{o.forEach(o=>{const s=JSON.parse(t);if(s&&s.userName){const t=i(Date.now()).format("MMMM D/YY, h:mma");e.broadcast.to(o).emit(f.ACTION,{type:S.SocketServerActionTypes.LEFT_ROOM,data:{roomId:o,message:{key:Date.now().toString(),time:t,text:`${s.userName} left the room`}}})}})}).catch(e=>{p.default({shouldPrintLogs:t.shouldPrintRedisLogs,messageOrigin:"REDIS_SESSION_ERROR",messages:e})})}},TM0L:function(e,t){e.exports=require("ioredis")},WNab:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=o("2apR"),r=o("AtKU");t.default=class{constructor(e){this.storeUser=(e=>new Promise((t,o)=>{this.client.setex(e.socketId,e.ttl||r.production.socket.userSocketSessionExpire,e.data,s.default(t,o))})),this.removeUser=(e=>new Promise((t,o)=>{this.client.del(e)})),this.getUser=(e=>new Promise((t,o)=>{this.client.get(e,s.default(t,o))})),this.client=e}}},Y7hk:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=o("wy2R"),r=o("1hBF"),n=o("40N5"),i=o("jxKE"),u=o("RRgj");t.default=((e,t,o)=>{const a=s(Date.now()).format("MMMM D/YY, h:mma");Object.keys(e.rooms).filter(t=>t!==e.id).forEach(t=>{e.broadcast.to(t).emit("event",`${o.userName} left the room`),e.leave(t)}),e.join(o.roomId,()=>{r.default({shouldPrintLogs:u.shouldPrintSocketLogs,messageOrigin:"SOCKET_IO_LOGS",messages:`User, ${o.userName} with socketId ${e.id}, joined room ${o.roomId}`}),r.default({shouldPrintLogs:u.shouldPrintSocketLogs,messageOrigin:"SOCKET_IO_LOGS",messages:`${o.userName}'s Current Rooms: ${JSON.stringify(e.rooms)}`}),e.emit(i.ACTION,{type:n.SocketServerActionTypes.JOINED_ROOM,data:{roomId:o.roomId,message:{key:Date.now().toString(),time:a,text:`You joined room ${o.roomId}`},userName:o.userName}}),e.broadcast.to(o.roomId).emit(i.ACTION,{type:n.SocketServerActionTypes.OTHER_JOINED_ROOM,data:{roomId:o.roomId,message:{key:Date.now().toString(),time:a,text:`${o.userName} joined room ${o.roomId}`}}})})})},ZEFf:function(e,t){e.exports=require("express")},aOOa:function(e,t,o){"use strict";var s;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.transportClose="transport close",e.pingTimeout="ping timeout"}(s||(s={})),t.default=s},dHGY:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=o("wy2R"),r=o("1hBF"),n=o("40N5"),i=o("jxKE"),u=o("RRgj");t.default=((e,t,o)=>{const a=s(Date.now()).format("MMMM D/YY, h:mma");e.handshake&&e.handshake.headers&&e.handshake.headers.host&&t.remove(e.id).then(t=>{e.emit(i.ACTION,{type:n.SocketServerActionTypes.SESSION_CLOSED_MESSAGE,data:t})}).catch(e=>{r.default({shouldPrintLogs:u.shouldPrintRedisLogs,messageOrigin:"REDIS_SESSION_ERROR",messages:e.toString()})}),r.default({shouldPrintLogs:u.shouldPrintSocketLogs,messageOrigin:"SOCKET_IO_LOGS",messages:`User, ${o.userName} with socketId ${e.id}, has LOGGED OUT.`}),e.emit(i.ACTION,{type:n.SocketServerActionTypes.USER_LOGOUT_SUCCESS,data:{message:{key:Date.now().toString(),time:a,text:"You have been logged in successfully."},userName:o.userName}})})},h5LZ:function(e,t){e.exports=require("yargs")},jxKE:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=o("aOOa");t.DisconnectReason=s.default;const r=o("MEnT");t.HttpErrors=r.default,t.ACTION="action"},mCUW:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=o("Y7hk");t.joinRoom=s.default;const r=o("7Hn7");t.login=r.default;const n=o("dHGY");t.logout=n.default;const i=o("o6Cw");t.sendMessage=i.default},"mw/K":function(e,t){e.exports=require("fs")},o6Cw:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=o("1hBF"),r=o("wy2R"),n=o("40N5"),i=o("jxKE"),u=o("RRgj");t.default=((e,t)=>{s.default({shouldPrintLogs:u.shouldPrintSocketLogs,messageOrigin:"SOCKET_IO_LOGS",messages:`${n.SocketClientActionTypes.SEND_MESSAGE}: ${t.toString()}`});const o=r(Date.now()).format("MMMM D/YY, h:mma");e.emit("action",{type:n.SocketServerActionTypes.SEND_MESSAGE,data:{roomId:t.roomId,message:{key:Date.now().toString(),time:o,text:`You: ${t.message}`}}}),e.broadcast.to(t.roomId).emit(i.ACTION,{type:n.SocketServerActionTypes.SEND_MESSAGE,data:{roomId:t.roomId,message:{key:Date.now().toString(),time:o,text:`${t.userName}: ${t.message}`}}}),s.default({shouldPrintLogs:u.shouldPrintSocketLogs,messageOrigin:"SOCKET_IO_LOGS",messages:`${t.userName} said: ${t.message}`})})},wy2R:function(e,t){e.exports=require("moment")},xpYa:function(e,t){e.exports=require("socket.io-redis")}})});