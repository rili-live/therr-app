!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var s in r)("object"==typeof exports?exports:e)[s]=r[s]}}(global,function(){return function(e){var t={};function r(s){if(t[s])return t[s].exports;var o=t[s]={i:s,l:!1,exports:{}};return e[s].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(s,o,function(t){return e[t]}.bind(null,o));return s},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/",r(r.s="dbOV")}({"1hBF":function(e,t,r){global,e.exports=function(e){var t={};function r(s){if(t[s])return t[s].exports;var o=t[s]={i:s,l:!1,exports:{}};return e[s].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(s,o,function(t){return e[t]}.bind(null,o));return s},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/",r(r.s="Sxyf")}({Sxyf:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=(e=>{if(e.shouldPrintLogs){const t=0!==e.time?`<at:${e.time||new Date}>`:"",r=Array.isArray(e.messages)?e.messages:[e.messages];for(let s=0;s<r.length;s+=1)e.messageOrigin?console.info(`${e.messageOrigin}${t}:`,r[s]):console.info(`LOG${t}:`,r[s])}})}})},"7WL4":function(e,t){e.exports=require("https")},"7wKX":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r("ZEFf"),o=r("EixS"),n=r("1hBF"),i=r("dbOV"),u=s.Router(),a=!1;t.default=class{constructor(e){this.router=u,this.getUser=(e=>this.knex.select("*").from("main.users").where({id:e}).debug(a).then(e=>{if(e&&e.length>0)return e[0];throw 404})),this.handleError=((e,t)=>{n.default({shouldPrintLogs:i.shouldPrintSQLLogs,messageOrigin:"SQL:USER_ROUTES:ERROR",messages:[e.toString()]}),t.status(500).end(o.error(500,e.toString()))}),this.knex=e,u.use((e,t,r)=>{n.default({shouldPrintLogs:i.shouldPrintSQLLogs,messageOrigin:`SQL:USER_ROUTES:${e.method}`,messages:[e.baseUrl]}),r()}),u.route("/users").get((t,r)=>{e.select("*").from("main.users").orderBy("id").debug(a).then(e=>{r.status(200).send(o.success(e))}).catch(e=>{this.handleError(e,r)})}).post((t,r)=>{e().insert({first_name:t.body.firstName,last_name:t.body.lastName,phone_number:t.body.phoneNumber,user_name:t.body.userName}).into("main.users").returning("id").debug(a).then(e=>{r.status(201).send(o.success({id:e[0]}))}).catch(e=>{this.handleError(e,r)})}),u.route("/users/:id").get((e,t)=>this.getUser(e.params.id).then(e=>{t.send(o.success(e))}).catch(r=>{404===r?t.status(404).send(o.error(404,`No user found with id, ${e.params.id}.`)):this.handleError(r,t)})).put((t,r)=>{e().update({first_name:t.body.firstName,last_name:t.body.lastName,phone_number:t.body.phoneNumber,user_name:t.body.userName}).into("main.users").where({id:t.params.id}).returning("*").debug(a).then(e=>this.getUser(t.params.id).then(e=>{r.status(200).send(o.success(e))})).catch(e=>{this.handleError(e,r)})}).delete((t,r)=>{e.delete().from("main.users").where({id:t.params.id}).then(e=>{e>0?r.status(200).send(o.success(`Customer with id, ${t.params.id}, was successfully deleted`)):r.status(404).send(o.error(404,`No user found with id, ${t.params.id}.`))}).catch(e=>{this.handleError(e,r)})})}}},"9Dq1":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r("1hBF"),o=r("dbOV");t.default=(e=>e.schema.hasTable("main.users").then(t=>{if(!t)return e.schema.createTable("main.users",e=>{e.increments("id"),e.string("user_name"),e.string("first_name"),e.string("last_name"),e.string("phone_number"),e.timestamps()}).debug(!1).then(()=>{s.default({shouldPrintLogs:o.shouldPrintSQLLogs,messageOrigin:"SQL:CREATE_TABLE:USERS",messages:["Users table created successfully"]})}).catch(e=>{s.default({shouldPrintLogs:o.shouldPrintSQLLogs,messageOrigin:"SQL:CREATE_TABLE:USERS",messages:["Users table failed to create",e.toString()]})})}))},AtKU:function(e,t){e.exports={development:{apiPort:7770,baseApiRoute:"http://localhost:7770/api/",baseSocketUrl:"http://localhost:7771",clientPort:7070,googleAnalyticsKey:"",redisHost:"127.0.0.1",redisPubPort:17771,redisSubPort:17772,socketPort:7771,socket:{pingInterval:1e4,pingTimeout:5e3,userSocketSessionExpire:36e5}},production:{apiPort:7770,baseApiRoute:"http://rili.live:7770/api/",baseSocketUrl:"https://rili.live:7743",clientPort:7070,googleAnalyticsKey:"",redisHost:"127.0.0.1",redisPubPort:17771,redisSubPort:17772,socketPort:7743,socket:{pingInterval:1e4,pingTimeout:5e3,userSocketSessionExpire:36e5}}}},EixS:function(e,t,r){var s;global,e.exports=(s=r("Os7e"),function(e){var t={};function r(s){if(t[s])return t[s].exports;var o=t[s]={i:s,l:!1,exports:{}};return e[s].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(s,o,function(t){return e[t]}.bind(null,o));return s},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/",r(r.s="rPjh")}({Os7e:function(e,t){e.exports=s},rPjh:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r("Os7e");t.error=((e,t)=>({error:t,statusCode:e,status:s[e]})),t.success=(e=>({data:e}))}}))},Os7e:function(e,t){e.exports=require("http-status")},SWt3:function(e,t){e.exports=require("body-parser")},SfJF:function(e,t){e.exports=require("knex")},ZEFf:function(e,t){e.exports=require("express")},dbOV:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r("u/k4"),o=r("SWt3"),n=r("ZEFf"),i=r("mw/K"),u=r("7WL4"),a=r("jle/"),l=r("oyvS"),c=r("h5LZ"),d=r("SfJF"),f=r("AtKU"),p=r("1hBF"),g=r("9Dq1"),h=r("7wKX");t.shouldPrintAllLogs=c.argv.withAllLogs,t.shouldPrintSQLLogs=c.argv.withSQLLogs||t.shouldPrintAllLogs,t.shouldPrintServerLogs=c.argv.withServerLogs||t.shouldPrintAllLogs;const m=n();m.use(o.json()),m.use(n.static(l.join(__dirname,"static")));const b=d({client:"pg",connection:{user:process.env.PG_USER,host:process.env.PG_HOST,database:process.env.PG_DATABASE,password:process.env.PG_PASSWORD,port:process.env.PG_PORT},pool:{min:2,max:10,log:!0},acquireConnectionTimeout:6e4});if(g.default(b).then(()=>{m.use("/api",new h.default(b).router)}),s.isMaster&&c.argv.shouldCluster){const e=a.cpus().length;p.default({shouldPrintLogs:t.shouldPrintServerLogs,messageOrigin:"API_SERVER",messages:`Master cluster setting up ${e} workers...`});for(let t=0;t<e;t+=1)s.fork();s.on("online",e=>{p.default({shouldPrintLogs:t.shouldPrintServerLogs,messageOrigin:"API_SERVER",messages:`Worker ${e.process.pid} is online`})}),s.on("exit",(e,r,o)=>{p.default({shouldPrintLogs:t.shouldPrintServerLogs,messageOrigin:"API_SERVER",messages:`Worker ${e.process.pid} died with code: ${r}, and signal: ${o}`}),p.default({shouldPrintLogs:t.shouldPrintServerLogs,messageOrigin:"API_SERVER",messages:"Starting a new worker"}),s.fork()})}else{const e={key:i.readFileSync(process.env.DOMAIN_KEY_LOCATION),cert:i.readFileSync(process.env.DOMAIN_CERT_LOCATION)};u.createServer(e,m).listen(f.production.apiPort)}},h5LZ:function(e,t){e.exports=require("yargs")},"jle/":function(e,t){e.exports=require("os")},"mw/K":function(e,t){e.exports=require("fs")},oyvS:function(e,t){e.exports=require("path")},"u/k4":function(e,t){e.exports=require("cluster")}})});