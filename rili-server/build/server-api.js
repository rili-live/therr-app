!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var o in r)("object"==typeof exports?exports:e)[o]=r[o]}}(global,function(){return function(e){var t={};function r(o){if(t[o])return t[o].exports;var s=t[o]={i:o,l:!1,exports:{}};return e[o].call(s.exports,s,s.exports,r),s.l=!0,s.exports}return r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(o,s,function(t){return e[t]}.bind(null,s));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/",r(r.s="dbOV")}({"1hBF":function(e,t,r){global,e.exports=function(e){var t={};function r(o){if(t[o])return t[o].exports;var s=t[o]={i:o,l:!1,exports:{}};return e[o].call(s.exports,s,s.exports,r),s.l=!0,s.exports}return r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(o,s,function(t){return e[t]}.bind(null,s));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/",r(r.s="Sxyf")}({Sxyf:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=(e=>{if(e.shouldPrintLogs){const t=0!==e.time?`<at:${e.time||new Date}>`:"",r=Array.isArray(e.messages)?e.messages:[e.messages];for(let o=0;o<r.length;o+=1)e.messageOrigin?console.info(`${e.messageOrigin}${t}:`,r[o]):console.info(`LOG${t}:`,r[o])}})}})},"7wKX":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=r("ZEFf"),s=r("EixS"),n=r("1hBF"),i=r("dbOV"),u=o.Router();t.default=class{constructor(e){this.router=u,this.getUser=(e=>new Promise((t,r)=>{const o=[e];this.connection.query("SELECT * FROM users WHERE id = $1",o,(e,o)=>{e?r(e):o&&o.rows.length>0?t(o.rows[0]):r(404)})})),this.handleError=((e,t)=>{n.default({shouldPrintLogs:i.shouldPrintSQLLogs,messageOrigin:"SQL:USER_ROUTES:ERROR",messages:[e.toString()]}),t.status(500).end(s.error(500,e.toString()))}),this.connection=e,u.use((e,t,r)=>{n.default({shouldPrintLogs:i.shouldPrintSQLLogs,messageOrigin:`SQL:USER_ROUTES:${e.method}`,messages:[e.baseUrl]}),r()}),u.route("/").get((t,r)=>{e.query("\n                    SELECT * from users;\n                ",(e,t)=>{e?this.handleError(e,r):r.status(200).send(s.success(t.rows))})}).post((t,r)=>{const o=[t.body.firstName,t.body.lastName,t.body.phoneNumber];e.query("\n                    INSERT INTO users (first_name, last_name, phone_number) values($1, $2, $3) RETURNING *;\n                ",o,(e,t)=>{e?this.handleError(e,r):r.status(201).send(s.success(t.rows[0]))})}),u.route("/:id").get((e,t)=>{this.getUser(e.params.id).then(e=>{t.send(e)}).catch(r=>{404===r?t.status(404).send(s.error(404,`No user found with id, ${e.params.id}.`)):this.handleError(r,t)})}).put((t,r)=>{const o=[t.body.firstName,t.body.lastName,t.body.phoneNumber,t.params.id];e.query("\n                    UPDATE users\n                    SET\n                        first_name = $1,\n                        last_name = $2,\n                        phone_number = $3\n                    WHERE id = $4;\n                ",o,(e,o)=>{e?this.handleError(e,r):this.getUser(t.params.id).then(e=>{r.status(200).send(s.success(e))})})}).delete((t,r)=>{const o=[t.params.id];e.query("\n                    DELETE from users\n                    WHERE id = $1;\n                ",o,(e,o)=>{e?this.handleError(e,r):o.rowCount>0?r.status(200).send(s.success(`Customer with id, ${t.params.id}, was successfully deleted`)):r.status(404).send(s.error(404,`No user found with id, ${t.params.id}.`))})})}}},"9Dq1":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=r("1hBF"),s=r("dbOV");t.default=(e=>{e.query("\n        CREATE TABLE IF NOT EXISTS users (\n            id SERIAL NOT NULL,\n            first_name VARCHAR(255),\n            last_name VARCHAR(255) NOT NULL,\n            phone_number VARCHAR(255) NOT NULL,\n            PRIMARY KEY (id)\n        );\n    ",(t,r)=>{t?o.default({shouldPrintLogs:s.shouldPrintSQLLogs,messageOrigin:"SQL:CREATE_TABLE:USERS",messages:["Users table failed to create",t.toString()]}):o.default({shouldPrintLogs:s.shouldPrintSQLLogs,messageOrigin:"SQL:CREATE_TABLE:USERS",messages:["Users table created successfully"]}),e.end()})})},AtKU:function(e,t){e.exports={development:{apiPort:7770,baseApiRoute:"http://localhost:7770/api/",baseSocketUrl:"http://localhost:7771",clientPort:7070,googleAnalyticsKey:"",postgresDatabase:"rili_db_main_dev",postgresHost:"127.0.0.1",postgresPassword:"secret",postgresPort:7432,postgresUser:"riliAdmin",redisHost:"127.0.0.1",redisPubPort:17771,redisSubPort:17772,socketPort:7771,security:{certLocation:"/etc/letsencrypt/live/rili.live/fullchain.pem",keyLocation:"/etc/letsencrypt/live/rili.live/privkey.pem"},socket:{pingInterval:1e4,pingTimeout:5e3,userSocketSessionExpire:36e5}},production:{apiPort:7770,baseApiRoute:"http://rili.live:7770/api/",baseSocketUrl:"https://rili.live:7743",clientPort:7070,googleAnalyticsKey:"",postgresDatabase:"rili_db_main_prod",postgresHost:"127.0.0.1",postgresPassword:"secret",postgresPort:7432,postgresUser:"riliAdmin",redisHost:"127.0.0.1",redisPubPort:17771,redisSubPort:17772,socketPort:7743,security:{certLocation:"/etc/letsencrypt/live/rili.live/fullchain.pem",keyLocation:"/etc/letsencrypt/live/rili.live/privkey.pem"},socket:{pingInterval:1e4,pingTimeout:5e3,userSocketSessionExpire:36e5}}}},EixS:function(e,t,r){var o;global,e.exports=(o=r("Os7e"),function(e){var t={};function r(o){if(t[o])return t[o].exports;var s=t[o]={i:o,l:!1,exports:{}};return e[o].call(s.exports,s,s.exports,r),s.l=!0,s.exports}return r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(o,s,function(t){return e[t]}.bind(null,s));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/",r(r.s="rPjh")}({Os7e:function(e,t){e.exports=o},rPjh:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=r("Os7e");t.error=((e,t)=>({error:t,statusCode:e,status:o[e]})),t.success=(e=>({data:e}))}}))},Os7e:function(e,t){e.exports=require("http-status")},SWt3:function(e,t){e.exports=require("body-parser")},ZEFf:function(e,t){e.exports=require("express")},dbOV:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=r("u/k4"),s=r("SWt3"),n=r("ZEFf"),i=r("jle/"),u=r("oyvS"),l=r("fMim"),a=r("h5LZ"),c=r("1hBF"),d=r("AtKU"),p=r("9Dq1"),f=r("7wKX");t.shouldPrintAllLogs=a.argv.withAllLogs,t.shouldPrintSQLLogs=a.argv.withSQLLogs||t.shouldPrintAllLogs;const g=n();g.use(s.json()),g.use(n.static(u.join(__dirname,"static")));const m={user:d.production.postgresUser,host:d.production.postgresHost,database:d.production.postgresDatabase,password:d.production.postgresPassword,port:d.production.postgresPort},b=new l.Pool(m);b.on("error",(e,r)=>{c.default({shouldPrintLogs:t.shouldPrintSQLLogs,messageOrigin:"SQL:POOL:ERROR",messages:[r.toString(),e.toString()]})});const h=new l.Client(m);if(h.connect(e=>{e?c.default({shouldPrintLogs:t.shouldPrintSQLLogs,messageOrigin:"SQL:CLIENT:CONNECTION_ERROR",messages:[e.toString()]}):(c.default({shouldPrintLogs:t.shouldPrintSQLLogs,messageOrigin:"SQL:CLIENT:CONNECTION_SUCCESS",messages:["Client connected to PostgreSQL"]}),p.default(h))}),h.on("error",e=>{c.default({shouldPrintLogs:t.shouldPrintSQLLogs,messageOrigin:"SQL:CLIENT:ERROR",messages:[e.toString()]})}),g.use("/users",new f.default(b).router),o.isMaster&&a.argv.shouldCluster){const e=i.cpus().length;console.log(`Master cluster setting up ${e} workers...`);for(let t=0;t<e;t+=1)o.fork();o.on("online",e=>{console.log(`Worker ${e.process.pid} is online`)}),o.on("exit",(e,t,r)=>{console.log(`Worker ${e.process.pid} died with code: ${t}, and signal: ${r}`),console.log("Starting a new worker"),o.fork()})}else g.listen(d.production.apiPort,e=>{if(e)throw e;console.log(`Server running on port ${d.production.apiPort} with process id`,process.pid)})},fMim:function(e,t){e.exports=require("pg")},h5LZ:function(e,t){e.exports=require("yargs")},"jle/":function(e,t){e.exports=require("os")},oyvS:function(e,t){e.exports=require("path")},"u/k4":function(e,t){e.exports=require("cluster")}})});